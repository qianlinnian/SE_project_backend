%% Traffic Monitor Module - Classical 4-Layer Architecture
graph TB
    subgraph Presentation["Presentation Layer (è¡¨çŽ°å±‚)"]
        AdminUI["ðŸ‘¤ Admin Dashboard\n(å¤§å±ã€ç»Ÿè®¡æŸ¥è¯¢)"]
        PoliceUI["ðŸ‘® Police UI\n(å®žæ—¶ç›‘æŽ§ã€è·¯å£æ•°æ®)"]
        WebApp["ðŸŒ Web Frontend\n(React/Vue)"]
    end

    subgraph Business["Business Logic Layer (ä¸šåŠ¡é€»è¾‘å±‚)"]
        TrafficCtrl["TrafficMonitorController\n- getAllIntersections()\n- getIntersectionRealtime(id)\n- getDashboardStats()\n- getHeatmapData()"]
        TrafficService["TrafficMonitorService (concept)\n- calculate congestion\n- aggregate stats\n- heatmap processing"]
    end

    subgraph Data["Data Access Layer (æ•°æ®è®¿é—®å±‚)"]
        RedisService["RedisService\n- setTrafficStatus(id, data)\n- getTrafficStatus(id)\n- getDashboardStats()\n- getHeatmapData()\n- TTL management"]
        MySQLDAO["MySQL DAO\n(intersections table)"]
    end

    subgraph Infrastructure["Infrastructure Layer (åŸºç¡€è®¾æ–½å±‚)"]
        Redis["ðŸ”´ Redis Cache\n(intersection:{id},\ndashboard:stats,\ndashboard:heatmap)"]
        MySQL["ðŸŸ¢ MySQL Database\n(intersections,\nbusiness entities)"]
        RTSP["ðŸ“¹ RTSP/HLS Server\n(stream URLs)"]
        OSS["â˜ï¸ Object Storage\n(evidence images, if any)"]
        Camera["ðŸ“· Cameras / AI Devices\n(RTSP stream,\nmetrics upload)"]
    end

    %% Presentation -> Business
    AdminUI -->|GET /api/dashboard/stats| TrafficCtrl
    AdminUI -->|GET /api/dashboard/heatmap| TrafficCtrl
    PoliceUI -->|GET /api/intersections| TrafficCtrl
    PoliceUI -->|GET /api/intersections/{id}/realtime| TrafficCtrl
    WebApp -->|REST API calls| TrafficCtrl

    %% Business -> Data
    TrafficCtrl --> RedisService
    TrafficCtrl --> MySQLDAO
    TrafficService --> RedisService
    TrafficService --> MySQLDAO

    %% Data -> Infrastructure
    RedisService --> Redis
    MySQLDAO --> MySQL
    TrafficCtrl -->|request stream URL| RTSP
    RedisService -->|read/write cache| Redis

    %% Infrastructure
    Camera -->|POST /api/intersections/{id}\n(metrics, image)| TrafficCtrl
    RTSP -->|provide stream URLs| PoliceUI

    %% Styling
    classDef presentation fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef business fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef data fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef infrastructure fill:#e0f2f1,stroke:#00796b,stroke-width:2px

    class AdminUI,PoliceUI,WebApp presentation
    class TrafficCtrl,TrafficService business
    class RedisService,MySQLDAO data
    class Redis,MySQL,RTSP,OSS,Camera infrastructure
