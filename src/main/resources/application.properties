# 应用配置
spring.application.name=traffic-management-system
server.port=8081

# MySQL数据库配置
# Docker环境使用服务名，本地开发使用localhost
spring.datasource.url=jdbc:mysql://${MYSQL_HOST:traffic-db}:3306/traffic_mind?useSSL=false&serverTimezone=Asia/Shanghai&characterEncoding=UTF-8&allowPublicKeyRetrieval=true
spring.datasource.username=root
spring.datasource.password=TrafficMind@2024
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# JPA配置
spring.jpa.database-platform=org.hibernate.dialect.MySQLDialect
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# Redis配置
# Docker环境使用服务名，本地开发使用localhost
spring.data.redis.host=${REDIS_HOST:redis}
spring.data.redis.port=6379
spring.data.redis.password=
spring.data.redis.database=0
spring.data.redis.timeout=2000ms
spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-wait=-1ms
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=0

# 日志配置
logging.level.com.traffic.management=DEBUG
logging.charset.console=UTF-8
logging.charset.file=UTF-8
logging.pattern.console=%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n

# MinIO配置
# Docker环境使用服务名，本地开发使用localhost
minio.endpoint=${MINIO_ENDPOINT:http://minio:9000}
minio.access-key=minioadmin
minio.secret-key=minioadmin
minio.bucket-name=traffic-violations
minio.public-access=true

# JWT配置
# HS512算法要求密钥长度至少为512位(64字节)，当前设置长度充足
jwt.secret=TrafficMindSecretKeyForJWTTokenGenerationAndValidation2024_MakeItLongerThan512BitsForHS512SecurityStandard
jwt.expiration=604800000

# Jackson配置 - 解决LocalDateTime序列化问题
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.deserialization.fail-on-unknown-properties=false
spring.jackson.default-property-inclusion=non_null

# 日志配置
logging.level.com.traffic.management=INFO

# 文件上传配置
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# HTTP编码配置
server.servlet.encoding.charset=UTF-8
server.servlet.encoding.force=true
server.servlet.encoding.enabled=true

# 视频处理配置
app.video.temp-dir=/tmp/traffic-videos
app.video.frame-interval=2
app.video.max-video-size=100MB

# =========================== AI集成配置 ===========================
# AI服务配置（AI同学需要提供实际地址）
ai.service.base-url=https://u836978-a67f-943bbb9f.westc.gpuhub.com:8443
ai.service.analyze-endpoint=/analyze-video
ai.service.control-endpoint=/api/control/mode
ai.service.timeout.connect=30
ai.service.timeout.read=300
ai.service.retry.max-attempts=3
ai.service.retry.delay=10

# 回调配置
# AI服务回调后端时使用容器内服务名（容器内调用）
server.callback.base-url=http://backend:8081
server.callback.ai-result-path=/api/violation-detection/ai-callback

# 文件存储配置
# 使用相对路径，相对于项目运行目录
# Windows和Linux都支持，部署时会自动在当前工作目录下创建
file.upload.base-path=./uploads
# 文件URL返回给前端使用（必须是外网地址，供浏览器访问）
file.url.base-url=http://47.107.50.136:8081/api/files

# 异步处理配置
spring.task.execution.pool.core-size=8
spring.task.execution.pool.max-size=16
spring.task.execution.pool.queue-capacity=100
spring.task.execution.thread-name-prefix=async-task-

# WebSocket配置（添加服务器前端地址）
app.websocket.allowed-origins=http://localhost:3000,http://localhost:8080,http://47.107.50.136:3000,http://47.107.50.136
app.websocket.message-broker.enabled=true

# Actuator配置 - 健康检查和监控
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=when-authorized
management.endpoint.health.probes.enabled=true
management.health.redis.enabled=true
management.health.db.enabled=true