###############################################
# 多路口四方向交通信号灯控制测试用例
###############################################

### 获取系统支持的元数据信息
GET http://localhost:8081/api/multi-direction-traffic/metadata

###############################################
# 路口配置查询
###############################################

### 1. 查询路口1的所有方向配置
GET http://localhost:8081/api/multi-direction-traffic/intersections/1/directions

### 2. 查询路口1所有方向的当前状态
GET http://localhost:8081/api/multi-direction-traffic/intersections/1/status

### 3. 查询路口1南向直行的具体状态
GET http://localhost:8081/api/multi-direction-traffic/intersections/1/directions/SOUTH/turns/STRAIGHT/status

### 4. 查询路口1东向左转的具体状态
GET http://localhost:8081/api/multi-direction-traffic/intersections/1/directions/EAST/turns/LEFT_TURN/status

###############################################
# 信号灯状态模拟测试
###############################################

### 5. 设置路口1南向直行为绿灯
POST http://localhost:8081/api/multi-direction-traffic/intersections/1/simulate
Content-Type: application/x-www-form-urlencoded

direction=SOUTH&turnType=STRAIGHT&lightPhase=GREEN&duration=45

### 6. 设置路口1南向左转为红灯
POST http://localhost:8081/api/multi-direction-traffic/intersections/1/simulate
Content-Type: application/x-www-form-urlencoded

direction=SOUTH&turnType=LEFT_TURN&lightPhase=RED&duration=60

### 7. 设置路口1东向直行为红灯
POST http://localhost:8081/api/multi-direction-traffic/intersections/1/simulate
Content-Type: application/x-www-form-urlencoded

direction=EAST&turnType=STRAIGHT&lightPhase=RED&duration=30

### 8. 设置路口1西向右转为绿灯
POST http://localhost:8081/api/multi-direction-traffic/intersections/1/simulate
Content-Type: application/x-www-form-urlencoded

direction=WEST&turnType=RIGHT_TURN&lightPhase=GREEN&duration=25

###############################################
# 违章验证测试 - 南向直行绿灯场景
###############################################

### 9. 测试南向直行绿灯时直行（应该不构成违章）
POST http://localhost:8081/api/multi-direction-traffic/intersections/1/validate-violation
Content-Type: application/json

{
  "direction": "SOUTH",
  "turnType": "STRAIGHT", 
  "violationType": "RED_LIGHT"
}

### 10. 测试南向直行绿灯时左转（应该构成违章，因为左转是红灯）
POST http://localhost:8081/api/multi-direction-traffic/intersections/1/validate-violation
Content-Type: application/json

{
  "direction": "SOUTH",
  "turnType": "LEFT_TURN",
  "violationType": "ILLEGAL_TURN"
}

###############################################
# 多方向违章检测实际场景测试
###############################################

### 11. 南向直行车辆闯红灯检测（绿灯状态下不应构成违章）
POST http://localhost:8081/api/violation-detection/detect-frame
Content-Type: application/json

{
  "intersectionId": 1,
  "plateNumber": "沪A11111",
  "violationType": "闯红灯",
  "direction": "SOUTH",
  "turnType": "STRAIGHT",
  "imageUrl": "http://localhost:9000/traffic-violations/south_straight_green.jpg",
  "confidence": 0.95,
  "cameraId": "south-cam-001",
  "description": "南向直行绿灯时直行（不应构成违章）"
}

### 12. 南向左转车辆违法转弯检测（左转红灯状态下应构成违章）
POST http://localhost:8081/api/violation-detection/detect-frame
Content-Type: application/json

{
  "intersectionId": 1,
  "plateNumber": "沪A22222",
  "violationType": "违法转弯",
  "direction": "SOUTH", 
  "turnType": "LEFT_TURN",
  "imageUrl": "http://localhost:9000/traffic-violations/south_left_red.jpg",
  "confidence": 0.92,
  "cameraId": "south-left-cam-001",
  "description": "南向左转红灯时左转（应构成违章）"
}

### 13. 东向直行车辆闯红灯检测（红灯状态下应构成违章）
POST http://localhost:8081/api/violation-detection/detect-frame
Content-Type: application/json

{
  "intersectionId": 1,
  "plateNumber": "沪A33333", 
  "violationType": "闯红灯",
  "direction": "EAST",
  "turnType": "STRAIGHT",
  "imageUrl": "http://localhost:9000/traffic-violations/east_straight_red.jpg",
  "confidence": 0.97,
  "cameraId": "east-cam-001",
  "description": "东向直行红灯时直行（应构成违章）"
}

### 14. 西向右转车辆合法转弯（绿灯状态下不应构成违章）
POST http://localhost:8081/api/violation-detection/detect-frame
Content-Type: application/json

{
  "intersectionId": 1,
  "plateNumber": "沪A44444",
  "violationType": "违法转弯", 
  "direction": "WEST",
  "turnType": "RIGHT_TURN",
  "imageUrl": "http://localhost:9000/traffic-violations/west_right_green.jpg",
  "confidence": 0.88,
  "cameraId": "west-right-cam-001",
  "description": "西向右转绿灯时右转（不应构成违章）"
}

###############################################
# 不同路口测试
###############################################

### 15. 路口2的配置查询
GET http://localhost:8081/api/multi-direction-traffic/intersections/2/directions

### 16. 设置路口2北向直行为黄灯
POST http://localhost:8081/api/multi-direction-traffic/intersections/2/simulate
Content-Type: application/x-www-form-urlencoded

direction=NORTH&turnType=STRAIGHT&lightPhase=YELLOW&duration=5

### 17. 路口2北向直行黄灯时直行违章检测
POST http://localhost:8081/api/violation-detection/detect-frame
Content-Type: application/json

{
  "intersectionId": 2,
  "plateNumber": "沪B55555",
  "violationType": "闯红灯",
  "direction": "NORTH",
  "turnType": "STRAIGHT", 
  "imageUrl": "http://localhost:9000/traffic-violations/north_straight_yellow.jpg",
  "confidence": 0.89,
  "cameraId": "north-cam-002",
  "description": "北向直行黄灯时直行（应根据具体规则判断）"
}

###############################################
# 批量测试和状态查询
###############################################

### 18. 查询所有违章记录（验证方向和转弯类型是否正确记录）
GET http://localhost:8081/api/violations?page=1&size=20

### 19. 批量违章检测（多方向混合场景）
POST http://localhost:8081/api/violation-detection/detect-batch
Content-Type: application/json

{
  "violations": [
    {
      "intersectionId": 1,
      "plateNumber": "批量测试001",
      "violationType": "闯红灯",
      "direction": "SOUTH",
      "turnType": "STRAIGHT",
      "imageUrl": "http://localhost:9000/traffic-violations/batch_1.jpg",
      "confidence": 0.91,
      "cameraId": "batch-cam-1"
    },
    {
      "intersectionId": 1, 
      "plateNumber": "批量测试002",
      "violationType": "违法转弯",
      "direction": "EAST",
      "turnType": "LEFT_TURN",
      "imageUrl": "http://localhost:9000/traffic-violations/batch_2.jpg",
      "confidence": 0.87,
      "cameraId": "batch-cam-2"
    },
    {
      "intersectionId": 2,
      "plateNumber": "批量测试003",
      "violationType": "逆行",
      "direction": "WEST", 
      "turnType": "STRAIGHT",
      "imageUrl": "http://localhost:9000/traffic-violations/batch_3.jpg",
      "confidence": 0.95,
      "cameraId": "batch-cam-3"
    }
  ]
}

### 20. 清除路口缓存
DELETE http://localhost:8081/api/multi-direction-traffic/intersections/1/cache

###############################################
# 复杂场景测试
###############################################

### 21. 掉头行为测试（跟随左转信号灯）
POST http://localhost:8081/api/multi-direction-traffic/intersections/1/simulate
Content-Type: application/x-www-form-urlencoded

direction=NORTH&turnType=LEFT_TURN&lightPhase=GREEN&duration=20

###
POST http://localhost:8081/api/violation-detection/detect-frame
Content-Type: application/json

{
  "intersectionId": 1,
  "plateNumber": "掉头测试001",
  "violationType": "违法转弯",
  "direction": "NORTH",
  "turnType": "U_TURN",
  "imageUrl": "http://localhost:9000/traffic-violations/u_turn_test.jpg", 
  "confidence": 0.93,
  "cameraId": "north-uturn-cam",
  "description": "北向掉头（左转绿灯时应该合法）"
}

### 22. 跨实线测试（不受红绿灯影响）
POST http://localhost:8081/api/violation-detection/detect-frame
Content-Type: application/json

{
  "intersectionId": 1,
  "plateNumber": "跨线测试001",
  "violationType": "跨实线",
  "direction": "SOUTH",
  "turnType": "STRAIGHT",
  "imageUrl": "http://localhost:9000/traffic-violations/cross_line_test.jpg",
  "confidence": 0.96,
  "cameraId": "south-line-cam",
  "description": "跨实线违章（不受红绿灯状态影响，应始终违章）"
}